<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="../assets/buttons.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mo Tech: Game Pass/Bundle Order Form</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Link to the external stylesheet (for custom colors defined as variables) -->
    <link rel="stylesheet" href="style.css"> 

    <!-- Tailwind Configuration Script -->
    <script>
        // Custom colors defined as CSS variables in styles.css are referenced here
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': 'var(--primary-blue)', 
                        'accent-cyan': 'var(--accent-cyan)',  
                        'charcoal': 'var(--charcoal)',     
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen p-4 sm:p-8 text-white bg-charcoal flex items-center justify-center">

    <!-- HTML STRUCTURE -->
    <div class="max-w-xl w-full mx-auto">

        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-primary-blue to-accent-cyan tracking-tight">
                Order Your Game Passes & Bundles
            </h1>
            <p class="text-gray-400 mt-2 text-lg">Select the game and specify the exact pass or IN-GAME bundle you need.</p>
        </header>

        <!-- Confirmation Message Box (Hidden by default) -->
        <div id="confirmationMessage" class="hidden p-6 mb-8 rounded-lg border-2 border-primary-blue bg-gray-900/70 text-center shadow-lg transition-all duration-300">
            <!-- Content populated by JavaScript -->
        </div>

        <!-- Order Form (No action/method, relies on JS fetch) -->
        <form id="orderForm" class="space-y-6 bg-gray-800 p-8 rounded-xl shadow-2xl border border-gray-700/50">
            
            <!-- üëá YOUR REQUIRED ACCESS KEY -->
            <input type="hidden" name="access_key" value="98ebe649-5229-42f7-b9d9-233e61c79fc1">
            
            <!-- Web3Forms Mandatory Security Fields for JSON Submission -->
            <input type="hidden" name="_bot" value="">
            <input type="hidden" name="_subject" value="New Game Pass/Bundle Order">
            
            <!-- Game Checklist List (Replaces Dropdown) -->
            <div>
                <label class="block text-lg font-semibold mb-2 text-accent-cyan">Select Games (Current Stock):</label>
                <!-- Container for Checkbox list -->
                <div id="gameChecklistContainer" class="p-3 rounded-lg bg-gray-900 border border-gray-700 h-56 overflow-y-auto space-y-2">
                    <!-- Checkboxes are inserted here by JavaScript -->
                </div>
                <p class="text-sm text-gray-400 mt-2">Check all the games you wish to order.</p>
            </div>
            
            <!-- Specify Pass/Bundle Input -->
            <div>
                <label for="gamePassInput" class="block text-lg font-semibold mb-2 text-accent-cyan">Specify Pass / IN-GAME Bundle (If applicable):</label>
                <textarea id="gamePassInput" name="Requested_Pass_Bundle" rows="4" placeholder="e.g., Ultimate Pass (12 Mo), or, IN GAME V-Bucks Bundle (13,500). List multiple items on new lines." class="w-full p-3 rounded-lg bg-gray-900 border border-gray-700 text-gray-200 focus:ring-primary-blue focus:border-primary-blue transition duration-150 ease-in-out"></textarea>
                <p class="text-sm text-gray-400 mt-2">Required for bundles/passes, otherwise leave blank.</p>
            </div>

            <!-- Full Name Input -->
            <div>
                <label for="fullName" class="block text-lg font-semibold mb-2 text-accent-cyan">Full Name:</label>
                <input type="text" id="fullName" name="Customer_Name" required placeholder="John Doe" class="w-full p-3 rounded-lg bg-gray-900 border border-gray-700 text-gray-200 focus:ring-primary-blue focus:border-primary-blue transition duration-150 ease-in-out">
            </div>

            <!-- Phone Number Input -->
            <div>
                <label for="phoneNum" class="block text-lg font-semibold mb-2 text-accent-cyan">Phone Number:</label>
                <input type="tel" id="phoneNum" name="Phone_Number" required placeholder="+20 XXX XXX XXXX" class="w-full p-3 rounded-lg bg-gray-900 border border-gray-700 text-gray-200 focus:ring-primary-blue focus:border-primary-blue transition duration-150 ease-in-out">
            </div>

            <!-- Email Address Input -->
            <div>
                <label for="emailAddress" class="block text-lg font-semibold mb-2 text-accent-cyan">Email Address:</label>
                <input type="email" id="emailAddress" name="Email" required placeholder="example@gmail.com.com" class="w-full p-3 rounded-lg bg-gray-900 border border-gray-700 text-gray-200 focus:ring-primary-blue focus:border-primary-blue transition duration-150 ease-in-out">
            </div>

            <!-- Submit Button -->
            <button id="submitButton" type="submit" class="w-full py-3 mt-8 font-extrabold text-xl rounded-lg shadow-xl transform transition-all duration-300
                bg-accent-cyan hover:bg-primary-blue text-gray-900
                hover:scale-[1.02] hover:shadow-2xl hover:shadow-accent-cyan/50 focus:outline-none focus:ring-4 focus:ring-accent-cyan/70">
                Place Order
            </button>
        </form>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script type="module">
        // --- GLOBAL VARIABLES & DOM REFERENCES ---
        const gameChecklistContainer = document.getElementById('gameChecklistContainer');
        const orderForm = document.getElementById('orderForm');
        const submitButton = document.getElementById('submitButton');
        const confirmationBox = document.getElementById('confirmationMessage');

        // --- HARDCODED STOCK DATA (Games marked inStock: true are shown) ---
        const localStockData = [
            { id: "cyberpunk", name: "Cyberpunk 2077", inStock: true },
            { id: "eldenring", name: "Elden Ring", inStock: true },
            { id: "godofwar", name: "God of War Ragnar√∂k", inStock: true },
            { id: "hogwarts", name: "Hogwarts Legacy", inStock: false },
            { id: "spiderman", name: "Spider-Man 2", inStock: true },
            { id: "cod", name: "Call of Duty: MW III", inStock: true },
            { id: "fifa", name: "EA Sports FC 25", inStock: false },
            { id: "zelda", name: "The Legend of Zelda: Tears of the Kingdom", inStock: true },
            { id: "diablo", name: "Diablo IV", inStock: true },
            { id: "residentevil", name: "Resident Evil 4 Remake", inStock: true },
            { id: "finalfantasy", name: "Final Fantasy XVI", inStock: true },
            { id: "starfield", name: "Starfield", inStock: true },
            { id: "baldursgate", name: "Baldur's Gate 3", inStock: true },
            { id: "mariokart", name: "Mario Kart 8 Deluxe", inStock: true },
            { id: "minecraft", name: "Minecraft", inStock: true },
            { id: "animalcrossing", name: "Animal Crossing: New Horizons", inStock: false },
            { id: "fortnite", name: "Fortnite (Physical Edition)", inStock: true },
            { id: "rocketleague", name: "Rocket League (Collector's Edition)", inStock: true },
            { id: "gta5", name: "Grand Theft Auto V", inStock: true },
            { id: "reddead", name: "Red Dead Redemption 2", inStock: true },
            { id: "horizon", name: "Horizon Forbidden West", inStock: true },
            { id: "assassins", name: "Assassin's Creed Mirage", inStock: true },
            { id: "metroid", name: "Metroid Prime Remastered", inStock: true },
            { id: "tekken", name: "Tekken 8", inStock: true },
            { id: "streetfighter", name: "Street Fighter 6", inStock: true },
        ];

        // --- UI BUILDING LOGIC ---
        function buildGameChecklist(allGames) {
            gameChecklistContainer.innerHTML = '';
            
            const gamesInStock = allGames.filter(game => game.inStock === true);

            if (gamesInStock.length === 0) {
                gameChecklistContainer.innerHTML = '<p class="text-gray-500 p-2">--- No games currently in stock ---</p>';
                return;
            }

            gamesInStock.sort((a, b) => a.name.localeCompare(b.name));
            
            gamesInStock.forEach(game => {
                const itemDiv = document.createElement('div');
                itemDiv.className = "flex items-center text-gray-200 hover:bg-gray-700/50 p-1.5 rounded-md cursor-pointer transition duration-100";
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `game-${game.id}`;
                // This name is used to group the selected games later
                checkbox.name = 'Game_Selection_Checkbox'; 
                checkbox.value = game.name; 
                checkbox.className = 'w-5 h-5 text-accent-cyan bg-gray-900 border-gray-600 rounded focus:ring-primary-blue';
                
                const label = document.createElement('label');
                label.htmlFor = `game-${game.id}`;
                label.textContent = game.name;
                label.className = 'ml-3 text-sm font-medium w-full';

                itemDiv.appendChild(checkbox);
                itemDiv.appendChild(label);
                
                // Allow clicking the entire row to toggle the checkbox
                itemDiv.addEventListener('click', (e) => {
                    if (e.target !== checkbox) {
                        checkbox.checked = !checkbox.checked;
                    }
                });

                gameChecklistContainer.appendChild(itemDiv);
            });
        }

        // --- FORM SUBMISSION HANDLER (Uses Fetch API - JSON Method) ---
        async function submitOrderHandler(event) {
            event.preventDefault();

            // --- 1. Validation Logic ---
            const selectedGameCheckboxes = Array.from(orderForm.querySelectorAll('input[name="Game_Selection_Checkbox"]:checked'));
            
            if (selectedGameCheckboxes.length === 0) {
                confirmationBox.innerHTML = `<p class="text-red-400 font-semibold">Frrr, you gotta select at least one game to place your order.</p>`;
                confirmationBox.classList.remove('hidden');
                return;
            }

            // --- 2. Set Loading State ---
            submitButton.disabled = true;
            submitButton.textContent = 'Sending...';
            confirmationBox.classList.remove('hidden');
            confirmationBox.innerHTML = `<p class="text-xl font-bold text-accent-cyan">Processing your order...</p>`;
            
            try {
                // --- 3. Gather Data and Prepare JSON Payload ---
                const formData = new FormData(orderForm);
                const object = {};
                
                // Convert standard fields to object
                formData.forEach((value, key) => {
                    // Skip the common checkbox name
                    if (key !== 'Game_Selection_Checkbox') {
                        object[key] = value;
                    }
                });
                
                // Manually process selected games and format for email
                const selectedGameNames = selectedGameCheckboxes.map(checkbox => checkbox.value);
                object['Game_Selection'] = selectedGameNames.join('; '); 
                
                // --- 4. Send Data via Fetch to Web3Forms ---
                const response = await fetch("https://api.web3forms.com/submit", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(object)
                });
                
                const result = await response.json();

                // --- 5. Handle Response & Confirmation ---
                if (response.ok && result.success) {
                    const customerName = object['Customer_Name'];
                    const selectedGameListDisplay = selectedGameNames.join(', ');

                    confirmationBox.innerHTML = `
                        <p class="text-3xl font-bold text-green-400 mb-2">‚úÖ Order Sent!</p>
                        <p class="text-xl mb-4">Thank you, <span class="text-accent-cyan font-semibold">${customerName}</span>.</p>
                        <p class="text-lg">Your order for **${selectedGameListDisplay}** has been successfully sent. **Please wait while we will contact you soon!**</p>
                        <p class="mt-4 text-xs text-gray-500">(Details sent via Web3Forms)</p>
                    `;
                    orderForm.reset(); 
                    // Keep the button disabled to prevent accidental double-submission on success
                    submitButton.textContent = 'Order Placed'; 
                } else {
                    // Handle Web3Forms specific error message
                    console.error("Web3Forms error:", result);
                    const errorMessage = result.message || 'An unknown server error occurred.';
                    let displayedMessage = `<p class="text-lg mt-2 text-gray-300">${errorMessage}</p>`;

                    // Improved handling for the specific security error
                    if (errorMessage.includes("security reasons")) {
                         displayedMessage = `
                            <p class="text-lg mt-2 text-red-300 font-bold">Web3Forms Security Block üö®</p>
                            <p class="text-sm mt-1 text-gray-400">This error usually means the form is blocked because it's running on an **unrecognized domain** (like a local test environment).</p>
                            <p class="text-sm mt-1 text-gray-400">**Solution:** You must upload this HTML file to a live website (like GitHub Pages or Netlify) for the submission to work correctly.</p>
                        `;
                    }


                    confirmationBox.innerHTML = `
                        <p class="text-red-400 font-semibold">Submission failed: ‚ùå</p>
                        ${displayedMessage}
                    `;
                    submitButton.textContent = 'Try Again';
                    submitButton.disabled = false;
                }

            } catch (error) {
                // Handle network errors
                console.error("Fetch API error:", error);
                confirmationBox.innerHTML = `<p class="text-red-400 font-semibold">Damnnn, Network Error: Could not connect to Web3Forms API.</p>`;
                submitButton.textContent = 'Try Again';
                submitButton.disabled = false;
            }
        }


        // --- INITIALIZE ---
        document.addEventListener('DOMContentLoaded', () => {
            orderForm.addEventListener('submit', submitOrderHandler);
            buildGameChecklist(localStockData);
        });
    </script>
</body>
</html>
